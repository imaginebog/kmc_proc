function preProcFunc(p,paradigm)
% List of open inputs
% Named Directory Selector: Directory - cfg_files
% Named File Selector: File Set - cfg_files
 % enter the number of runs here
init

TR=2;
if strcmpi(paradigm,'MEMORIASENSE')
    TR=4;
end
slices=

Patients=cellstr(p);

nrun = size(Patients,2);
jobfile = {'/media/DATAPART5/kmc400/scripts/spm/singleFMRIscript_job.m'};
jobs = repmat(jobfile, 1, nrun);
inputs = cell(2, nrun);
for crun = 1:nrun
    disp(['Processing ' paradigm ' for subject '  Patients{crun}]) 
    Route='/media/DATAPART5/kmc400/spm';
    Patient=Patients{crun};
    PatientRoute=[Route '/' Patient];
    
    T1Route=[PatientRoute '/' 'T1'];
    T1file=[T1Route '/T1.nii'];
    T1cell{1}=T1file;
    InputRoute=[PatientRoute '/' paradigm];
    
    
    ParamDir=dir([T1Route '/sR*seg_sn.mat'] );
    if isempty(ParamDir)
        ParamDir=dir([T1Route '/T1_seg_sn.mat'] );
    end
    ParamFile=[T1Route '/' ParamDir(1).name];
    ParamCell{1}=ParamFile;
    
    InputFiles=[InputRoute '/BOLD-*.nii'];
    dirR=dir(InputFiles);

%    assert(length(dirR)==80)    

    for i = 1:1:length(dirR)
        namescell{i}=[InputRoute '/' dirR(i).name];
    end
    
    
    inputs{1, crun} = namescell; % Slice Timing: Session - cfg_files
    inputs{2, crun} = MATLAB_CODE_TO_FILL_INPUT; % Slice Timing: Number of Slices - cfg_entry
    inputs{3, crun} = MATLAB_CODE_TO_FILL_INPUT; % Slice Timing: TR - cfg_entry
    inputs{4, crun} = MATLAB_CODE_TO_FILL_INPUT; % Slice Timing: TA - cfg_entry
    inputs{5, crun} = MATLAB_CODE_TO_FILL_INPUT; % Slice Timing: Slice order - cfg_entry
    inputs{6, crun} = MATLAB_CODE_TO_FILL_INPUT; % Slice Timing: Reference Slice - cfg_entry
    inputs{7, crun} = namescell; % Coregister: Estimate: Source Image - cfg_files
    inputs{8, crun} = ParamCell; % Normalise: Write: Parameter File - cfg_files
end
spm('defaults', 'FMRI');
spm_jobman('serial', jobs, '', inputs{:});
exit
end
